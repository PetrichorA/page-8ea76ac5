!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.RSVP=e.RSVP||{})}(this,(function(e){"use strict";function t(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function n(e){var t=e._promiseCallbacks;return t||(t=e._promiseCallbacks={}),t}function r(e,t){if(2!==arguments.length)return G[e];G[e]=t}function o(e){return"function"==typeof e}function i(e){return null!==e&&"object"==typeof e}function s(e,t,n){1===Z.push({name:e,payload:{key:t._guidKey,id:t._id,eventName:e,detail:t._result,childId:n&&n._id,label:t._label,timeStamp:Q(),error:G["instrument-with-stack"]?new Error(t._label):null}})&&setTimeout((function(){for(var e=0;e<Z.length;e++){var t=Z[e],n=t.payload;n.guid=n.key+n.id,n.childGuid=n.key+n.childId,n.error&&(n.stack=n.error.stack),G.trigger(t.name,t.payload)}Z.length=0}),50)}function a(e,t){if(e&&"object"==typeof e&&e.constructor===this)return e;var n=new this(c,t);return d(n,e),n}function c(){}function l(e){try{return e.then}catch(e){return re.error=e,re}}function u(e,t,n){t.constructor===e.constructor&&n===b&&e.constructor.resolve===a?function(e,t){t._state===te?h(e,t._result):t._state===ne?(t._onError=null,p(e,t._result)):m(t,void 0,(function(n){t!==n?d(e,n):h(e,n)}),(function(t){return p(e,t)}))}(e,t):n===re?(p(e,re.error),re.error=null):o(n)?function(e,t,n){G.async((function(e){var r=!1,o=function(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}(n,t,(function(n){r||(r=!0,t!==n?d(e,n):h(e,n))}),(function(t){r||(r=!0,p(e,t))}),e._label);!r&&o&&(r=!0,p(e,o))}),e)}(e,t,n):h(e,t)}function d(e,t){e===t?h(e,t):function(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}(t)?u(e,t,l(t)):h(e,t)}function f(e){e._onError&&e._onError(e._result),v(e)}function h(e,t){e._state===ee&&(e._result=t,e._state=te,0===e._subscribers.length?G.instrument&&s("fulfilled",e):G.async(v,e))}function p(e,t){e._state===ee&&(e._state=ne,e._result=t,G.async(f,e))}function m(e,t,n,r){var o=e._subscribers,i=o.length;e._onError=null,o[i]=t,o[i+te]=n,o[i+ne]=r,0===i&&e._state&&G.async(v,e)}function v(e){var t=e._subscribers,n=e._state;if(G.instrument&&s(n===te?"fulfilled":"rejected",e),0!==t.length){for(var r=void 0,o=void 0,i=e._result,a=0;a<t.length;a+=3)r=t[a],o=t[a+n],r?g(n,r,o,i):o(i);e._subscribers.length=0}}function y(){this.error=null}function g(e,t,n,r){var i=o(n),s=void 0,a=void 0;if(i){if((s=function(e,t){try{return e(t)}catch(e){return oe.error=e,oe}}(n,r))===oe)a=s.error,s.error=null;else if(s===t)return void p(t,new TypeError("A promises callback cannot return that same promise."))}else s=r;t._state!==ee||(i&&void 0===a?d(t,s):void 0!==a?p(t,a):e===te?h(t,s):e===ne&&p(t,s))}function b(e,t,n){var r=this,o=r._state;if(o===te&&!e||o===ne&&!t)return G.instrument&&s("chained",r,r),r;r._onError=null;var i=new r.constructor(c,n),a=r._result;if(G.instrument&&s("chained",r,i),o===ee)m(r,i,e,t);else{var l=o===te?e:t;G.async((function(){return g(o,i,l,a)}))}return i}function E(e,t,n){return e===te?{state:"fulfilled",value:n}:{state:"rejected",reason:n}}function S(){this.value=void 0}function w(e,t,n){try{e.apply(t,n)}catch(e){return le.value=e,le}}function k(e,t){for(var n={},r=e.length,o=new Array(r),i=0;i<r;i++)o[i]=e[i];for(var s=0;s<t.length;s++)n[t[s]]=o[s+1];return n}function P(e){for(var t=e.length,n=new Array(t-1),r=1;r<t;r++)n[r-1]=e[r];return n}function _(e,t){return{then:function(n,r){return e.call(t,n,r)}}}function C(e,t){var n=function(){for(var n=this,r=arguments.length,o=new Array(r+1),i=!1,s=0;s<r;++s){var a=arguments[s];if(!i){if((i=U(a))===ue){var l=new ce(c);return p(l,ue.value),l}i&&!0!==i&&(a=_(i,a))}o[s]=a}var u=new ce(c);return o[r]=function(e,n){e?p(u,e):void 0===t?d(u,n):!0===t?d(u,P(arguments)):W(t)?d(u,k(arguments,t)):d(u,n)},i?B(u,o,e,n):x(u,o,e,n)};return n.__proto__=e,n}function x(e,t,n,r){var o=w(n,r,t);return o===le&&p(e,o.value),e}function B(e,t,n,r){return ce.all(t).then((function(t){var o=w(n,r,t);return o===le&&p(e,o.value),e}))}function U(e){return!(!e||"object"!=typeof e)&&(e.constructor===ce||function(e){try{return e.then}catch(e){return le.value=e,le}}(e))}function J(e,t){return ce.all(e,t)}function O(e,t){return W(e)?new de(ce,e,t).promise:ce.reject(new TypeError("Promise.allSettled must be called with an array"),t)}function R(e,t){return ce.race(e,t)}function T(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function j(e,t){return i(e)?new he(ce,e,t).promise:ce.reject(new TypeError("Promise.hash must be called with an object"),t)}function N(e,t){return i(e)?new pe(ce,e,!1,t).promise:ce.reject(new TypeError("RSVP.hashSettled must be called with an object"),t)}function L(e){throw setTimeout((function(){throw e})),e}function A(e){var t={resolve:void 0,reject:void 0};return t.promise=new ce((function(e,n){t.resolve=e,t.reject=n}),e),t}function M(e,t,n){return W(e)?o(t)?ce.all(e,n).then((function(e){for(var r=e.length,o=new Array(r),i=0;i<r;i++)o[i]=t(e[i]);return ce.all(o,n)})):ce.reject(new TypeError("RSVP.map expects a function as a second argument"),n):ce.reject(new TypeError("RSVP.map must be called with an array"),n)}function D(e,t){return ce.resolve(e,t)}function $(e,t){return ce.reject(e,t)}function I(e,t){return ce.all(e,t)}function F(e,t,n){return W(e)||i(e)&&void 0!==e.then?o(t)?(W(e)?I(e,n):function(e,t){return ce.resolve(e,t).then((function(e){return I(e,t)}))}(e,n)).then((function(e){for(var r=e.length,o=new Array(r),i=0;i<r;i++)o[i]=t(e[i]);return I(o,n).then((function(t){for(var n=new Array(r),o=0,i=0;i<r;i++)t[i]&&(n[o]=e[i],o++);return n.length=o,n}))})):ce.reject(new TypeError("RSVP.filter expects function as a second argument"),n):ce.reject(new TypeError("RSVP.filter must be called with an array or promise"),n)}function z(e,t){ke[ve]=e,ke[ve+1]=t,2===(ve+=2)&&Pe()}function X(){return function(){return setTimeout(K,1)}}function K(){for(var e=0;e<ve;e+=2)(0,ke[e])(ke[e+1]),ke[e]=void 0,ke[e+1]=void 0;ve=0}function V(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function q(){G.on.apply(G,arguments)}function H(){G.off.apply(G,arguments)}var Y={mixin:function(e){return e.on=this.on,e.off=this.off,e.trigger=this.trigger,e._promiseCallbacks=void 0,e},on:function(e,r){if("function"!=typeof r)throw new TypeError("Callback must be a function");var o=n(this),i=void 0;(i=o[e])||(i=o[e]=[]),-1===t(i,r)&&i.push(r)},off:function(e,r){var o,i=n(this),s=void 0;r?-1!==(o=t(s=i[e],r))&&s.splice(o,1):i[e]=[]},trigger:function(e,t,r){var o;if(o=n(this)[e])for(var i=0;i<o.length;i++)(0,o[i])(t,r)}},G={instrument:!1};Y.mixin(G);var W=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},Q=Date.now||function(){return(new Date).getTime()},Z=[],ee=void 0,te=1,ne=2,re=new y,oe=new y,ie=function(){function e(e,t,n,r){this._instanceConstructor=e,this.promise=new e(c,r),this._abortOnReject=n,this._init.apply(this,arguments)}return e.prototype._init=function(e,t){var n=t.length||0;this.length=n,this._remaining=n,this._result=new Array(n),this._enumerate(t),0===this._remaining&&h(this.promise,this._result)},e.prototype._enumerate=function(e){for(var t=this.length,n=this.promise,r=0;n._state===ee&&r<t;r++)this._eachEntry(e[r],r)},e.prototype._settleMaybeThenable=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===a){var o=l(e);if(o===b&&e._state!==ee)e._onError=null,this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=this._makeResult(te,t,e);else if(n===ce){var i=new n(c);u(i,e,o),this._willSettleAt(i,t)}else this._willSettleAt(new n((function(t){return t(e)})),t)}else this._willSettleAt(r(e),t)},e.prototype._eachEntry=function(e,t){!function(e){return null!==e&&"object"==typeof e}(e)?(this._remaining--,this._result[t]=this._makeResult(te,t,e)):this._settleMaybeThenable(e,t)},e.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===ee&&(this._abortOnReject&&e===ne?p(r,n):(this._remaining--,this._result[t]=this._makeResult(e,t,n),0===this._remaining&&h(r,this._result)))},e.prototype._makeResult=function(e,t,n){return n},e.prototype._willSettleAt=function(e,t){var n=this;m(e,void 0,(function(e){return n._settledAt(te,t,e)}),(function(e){return n._settledAt(ne,t,e)}))},e}(),se="rsvp_"+Q()+"-",ae=0,ce=function(){function e(t,n){this._id=ae++,this._label=n,this._state=void 0,this._result=void 0,this._subscribers=[],G.instrument&&s("created",this),c!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){var n=!1;try{t((function(t){n||(n=!0,d(e,t))}),(function(t){n||(n=!0,p(e,t))}))}catch(t){p(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype._onError=function(e){var t=this;G.after((function(){t._onError&&G.trigger("error",e,t._label)}))},e.prototype.catch=function(e,t){return this.then(void 0,e,t)},e.prototype.finally=function(e,t){var n=this.constructor;return this.then((function(t){return n.resolve(e()).then((function(){return t}))}),(function(t){return n.resolve(e()).then((function(){throw t}))}),t)},e}();ce.cast=a,ce.all=function(e,t){return W(e)?new ie(this,e,!0,t).promise:this.reject(new TypeError("Promise.all must be called with an array"),t)},ce.race=function(e,t){var n=new this(c,t);if(!W(e))return p(n,new TypeError("Promise.race must be called with an array")),n;for(var r=0;n._state===ee&&r<e.length;r++)m(this.resolve(e[r]),void 0,(function(e){return d(n,e)}),(function(e){return p(n,e)}));return n},ce.resolve=a,ce.reject=function(e,t){var n=new this(c,t);return p(n,e),n},ce.prototype._guidKey=se,ce.prototype.then=b;var le=new S,ue=new S,de=function(e){function t(t,n,r){return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,t,n,!1,r))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(ie);de.prototype._makeResult=E;var fe=Object.prototype.hasOwnProperty,he=function(e){function t(t,n){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments[3];return T(this,e.call(this,t,n,r,o))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype._init=function(e,t){this._result={},this._enumerate(t),0===this._remaining&&h(this.promise,this._result)},t.prototype._enumerate=function(e){var t=this.promise,n=[];for(var r in e)fe.call(e,r)&&n.push({position:r,entry:e[r]});var o=n.length;this._remaining=o;for(var i=void 0,s=0;t._state===ee&&s<o;s++)i=n[s],this._eachEntry(i.entry,i.position)},t}(ie),pe=function(e){function t(t,n,r){return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,t,n,!1,r))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(he);pe.prototype._makeResult=E;var me,ve=0,ye=void 0,ge="undefined"!=typeof window?window:void 0,be=ge||{},Ee=be.MutationObserver||be.WebKitMutationObserver,Se="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),we="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ke=new Array(1e3),Pe=void 0;if(Pe=Se?function(){var e=process.nextTick,t=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(t)&&"0"===t[1]&&"10"===t[2]&&(e=setImmediate),function(){return e(K)}}():Ee?function(){var e=0,t=new Ee(K),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){return n.data=e=++e%2}}():we?function(){var e=new MessageChannel;return e.port1.onmessage=K,function(){return e.port2.postMessage(0)}}():void 0===ge&&"function"==typeof require?function(){try{var e=require("vertx");return void 0!==(ye=e.runOnLoop||e.runOnContext)?function(){ye(K)}:X()}catch(e){return X()}}():X(),"object"==typeof self)self;else{if("object"!=typeof global)throw new Error("no global: `self` or `global` found");global}G.async=z,G.after=function(e){return setTimeout(e,0)};var _e=D,Ce=function(e,t){return G.async(e,t)};if("undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var xe=window.__PROMISE_INSTRUMENTATION__;for(var Be in r("instrument",!0),xe)xe.hasOwnProperty(Be)&&q(Be,xe[Be])}var Ue=(V(me={asap:z,cast:_e,Promise:ce,EventTarget:Y,all:J,allSettled:O,race:R,hash:j,hashSettled:N,rethrow:L,defer:A,denodeify:C,configure:r,on:q,off:H,resolve:D,reject:$,map:M},"async",Ce),V(me,"filter",F),me);e.default=Ue,e.asap=z,e.cast=_e,e.Promise=ce,e.EventTarget=Y,e.all=J,e.allSettled=O,e.race=R,e.hash=j,e.hashSettled=N,e.rethrow=L,e.defer=A,e.denodeify=C,e.configure=r,e.on=q,e.off=H,e.resolve=D,e.reject=$,e.map=M,e.async=Ce,e.filter=F,Object.defineProperty(e,"__esModule",{value:!0})})),(EPUBJS=EPUBJS||{}).core={};var EPUBJS,ELEMENT_NODE=1,TEXT_NODE=3,COMMENT_NODE=8,DOCUMENT_NODE=9;EPUBJS.core.getEl=function(e){return document.getElementById(e)},EPUBJS.core.getEls=function(e){return document.getElementsByClassName(e)},EPUBJS.core.request=function(e,t,n){var r,o=window.URL,i=o?"blob":"arraybuffer",s=new RSVP.defer,a=new XMLHttpRequest,c=XMLHttpRequest.prototype;return"overrideMimeType"in c||Object.defineProperty(c,"overrideMimeType",{value:function(e){}}),a.onreadystatechange=function(){var e;this.readyState==this.DONE&&(200!==this.status&&0!==this.status||!this.response?s.reject({message:this.response,stack:(new Error).stack}):(e="xml"==t?this.responseXML?this.responseXML:(new DOMParser).parseFromString(this.response,"application/xml"):"xhtml"==t?this.responseXML?this.responseXML:(new DOMParser).parseFromString(this.response,"application/xhtml+xml"):"html"==t?this.responseXML?this.responseXML:(new DOMParser).parseFromString(this.response,"text/html"):"json"==t?JSON.parse(this.response):"blob"==t?o?this.response:new Blob([this.response]):this.response,s.resolve(e)))},a.open("GET",e,!0),n&&(a.withCredentials=!0),t||(r=EPUBJS.core.uri(e),t={htm:"html"}[t=r.extension]||t),"blob"==t&&(a.responseType=i),"json"==t&&a.setRequestHeader("Accept","application/json"),"xml"==t&&(a.responseType="document",a.overrideMimeType("text/xml")),"xhtml"==t&&(a.responseType="document"),"html"==t&&(a.responseType="document"),"binary"==t&&(a.responseType="arraybuffer"),a.send(),s.promise},EPUBJS.core.toArray=function(e){var t=[];for(var n in e){var r;e.hasOwnProperty(n)&&((r=e[n]).ident=n,t.push(r))}return t},EPUBJS.core.uri=function(e){var t,n,r,o={protocol:"",host:"",path:"",origin:"",directory:"",base:"",filename:"",extension:"",fragment:"",href:e},i=e.indexOf("blob:"),s=e.indexOf("://"),a=e.indexOf("?"),c=e.indexOf("#");return 0===i?(o.protocol="blob",o.base=e.indexOf(0,c),o):(-1!=c&&(o.fragment=e.slice(c+1),e=e.slice(0,c)),-1!=a&&(o.search=e.slice(a+1),e=e.slice(0,a),href=o.href),-1!=s?(o.protocol=e.slice(0,s),-1===(r=(t=e.slice(s+3)).indexOf("/"))?(o.host=o.path,o.path=""):(o.host=t.slice(0,r),o.path=t.slice(r)),o.origin=o.protocol+"://"+o.host,o.directory=EPUBJS.core.folder(o.path),o.base=o.origin+o.directory):(o.path=e,o.directory=EPUBJS.core.folder(e),o.base=o.directory),o.filename=e.replace(o.base,""),-1!=(n=o.filename.lastIndexOf("."))&&(o.extension=o.filename.slice(n+1)),o)},EPUBJS.core.folder=function(e){var t=e.lastIndexOf("/");return e.slice(0,t+1)},EPUBJS.core.dataURLToBlob=function(e){var t,n,r,o,i,s=";base64,";if(-1==e.indexOf(s))return n=(t=e.split(","))[0].split(":")[1],r=t[1],new Blob([r],{type:n});n=(t=e.split(s))[0].split(":")[1],o=(r=window.atob(t[1])).length,i=new Uint8Array(o);for(var a=0;a<o;++a)i[a]=r.charCodeAt(a);return new Blob([i],{type:n})},EPUBJS.core.addScript=function(e,t,n){var r,o;o=!1,(r=document.createElement("script")).type="text/javascript",r.async=!1,r.src=e,r.onload=r.onreadystatechange=function(){o||this.readyState&&"complete"!=this.readyState||(o=!0,t&&t())},(n=n||document.body).appendChild(r)},EPUBJS.core.addScripts=function(e,t,n){var r=e.length,o=0,i=function(){o++,r==o?t&&t():EPUBJS.core.addScript(e[o],i,n)};EPUBJS.core.addScript(e[o],i,n)},EPUBJS.core.addCss=function(e,t,n){var r,o;o=!1,(r=document.createElement("link")).type="text/css",r.rel="stylesheet",r.href=e,r.onload=r.onreadystatechange=function(){o||this.readyState&&"complete"!=this.readyState||(o=!0,t&&t())},(n=n||document.body).appendChild(r)},EPUBJS.core.prefixed=function(e){var t=["Webkit","Moz","O","ms"],n=e[0].toUpperCase()+e.slice(1),r=t.length;if(void 0!==document.documentElement.style[e])return e;for(var o=0;o<r;o++)if(void 0!==document.documentElement.style[t[o]+n])return t[o]+n;return e},EPUBJS.core.resolveUrl=function(e,t){var n=[],r=EPUBJS.core.uri(t),o=e.split("/");return r.host?t:(o.pop(),t.split("/").forEach((function(e){".."===e?o.pop():n.push(e)})),o.concat(n).join("/"))},EPUBJS.core.uuid=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:7&n|8).toString(16)}))},EPUBJS.core.insert=function(e,t,n){var r=EPUBJS.core.locationOf(e,t,n);return t.splice(r,0,e),r},EPUBJS.core.locationOf=function(e,t,n,r,o){var i,s=r||0,a=o||t.length,c=parseInt(s+(a-s)/2);return n||(n=function(e,t){return e>t?1:e<t?-1:(e=t)?0:void 0}),a-s<=0?c:(i=n(t[c],e),a-s==1?i>0?c:c+1:0===i?c:-1===i?EPUBJS.core.locationOf(e,t,n,c,a):EPUBJS.core.locationOf(e,t,n,s,c))},EPUBJS.core.indexOfSorted=function(e,t,n,r,o){var i,s=r||0,a=o||t.length,c=parseInt(s+(a-s)/2);return n||(n=function(e,t){return e>t?1:e<t?-1:(e=t)?0:void 0}),a-s<=0?-1:(i=n(t[c],e),a-s==1?0===i?c:-1:0===i?c:-1===i?EPUBJS.core.indexOfSorted(e,t,n,c,a):EPUBJS.core.indexOfSorted(e,t,n,s,c))},EPUBJS.core.queue=function(e){var t=[],n=e,r=function(){var e;t.length&&(e=t.shift(),n[e.funcName].apply(e.context||n,e.args))};return{enqueue:function(e,n,r){return t.push({funcName:e,args:n,context:r}),t},dequeue:r,flush:function(){for(;t.length;)r()},clear:function(){t=[]},length:function(){return t.length}}},EPUBJS.core.getElementXPath=function(e){return e&&e.id?'//*[@id="'+e.id+'"]':EPUBJS.core.getElementTreeXPath(e)},EPUBJS.core.getElementTreeXPath=function(e){var t,n,r,o,i=[],s="http://www.w3.org/1999/xhtml"===e.ownerDocument.documentElement.getAttribute("xmlns");for(e.nodeType===Node.TEXT_NODE&&(t=EPUBJS.core.indexOfTextNode(e)+1,i.push("text()["+t+"]"),e=e.parentNode);e&&1==e.nodeType;e=e.parentNode){t=0;for(var a=e.previousSibling;a;a=a.previousSibling)a.nodeType!=Node.DOCUMENT_TYPE_NODE&&a.nodeName==e.nodeName&&++t;n=e.nodeName.toLowerCase(),r=s?"xhtml:"+n:n,o=t?"["+(t+1)+"]":"",i.splice(0,0,r+o)}return i.length?"./"+i.join("/"):null},EPUBJS.core.nsResolver=function(e){return{xhtml:"http://www.w3.org/1999/xhtml",epub:"http://www.idpf.org/2007/ops"}[e]||null},EPUBJS.core.cleanStringForXpath=function(e){var t=e.match(/[^'"]+|['"]/g);return"concat('',"+(t=t.map((function(e){return"'"===e?'"\'"':'"'===e?"'\"'":"'"+e+"'"}))).join(",")+")"},EPUBJS.core.indexOfTextNode=function(e){for(var t,n=e.parentNode.childNodes,r=-1,o=0;o<n.length&&((t=n[o]).nodeType===Node.TEXT_NODE&&r++,t!=e);o++);return r},EPUBJS.core.defaults=function(e){for(var t=1,n=arguments.length;t<n;t++){var r=arguments[t];for(var o in r)void 0===e[o]&&(e[o]=r[o])}return e},EPUBJS.core.extend=function(e){return[].slice.call(arguments,1).forEach((function(t){t&&Object.getOwnPropertyNames(t).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))})),e},EPUBJS.core.clone=function(e){return EPUBJS.core.isArray(e)?e.slice():EPUBJS.core.extend({},e)},EPUBJS.core.isElement=function(e){return!(!e||1!=e.nodeType)},EPUBJS.core.isNumber=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},EPUBJS.core.isString=function(e){return"string"==typeof e||e instanceof String},EPUBJS.core.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},EPUBJS.core.values=function(e){var t,n,r,o=-1;if(!e)return[];for(n=(t=Object.keys(e)).length,r=Array(n);++o<n;)r[o]=e[t[o]];return r},EPUBJS.core.indexOfNode=function(e,t){for(var n,r=e.parentNode.childNodes,o=-1,i=0;i<r.length&&((n=r[i]).nodeType===t&&o++,n!=e);i++);return o},EPUBJS.core.indexOfTextNode=function(e){return EPUBJS.core.indexOfNode(e,TEXT_NODE)},EPUBJS.core.indexOfElementNode=function(e){return EPUBJS.core.indexOfNode(e,ELEMENT_NODE)},(EPUBJS=EPUBJS||{}).reader={},EPUBJS.reader.plugins={},function(e,t){var n=(e.ePubReader,e.ePubReader=function(e,t){return new EPUBJS.Reader(e,t)});"function"==typeof define&&define.amd?define((function(){return Reader})):"undefined"!=typeof module&&module.exports&&(module.exports=n)}(window,jQuery),EPUBJS.Reader=function(e,t){var n,r,o=this,i=$("#viewer"),s=window.location.search;for(r in this.settings=EPUBJS.core.defaults(t||{},{bookPath:e,restore:!1,reload:!1,bookmarks:void 0,annotations:void 0,contained:void 0,bookKey:void 0,styles:void 0,sidebarReflow:!1,generatePagination:!1,history:!0}),s&&s.slice(1).split("&").forEach((function(e){var t=e.split("="),n=t[0],r=t[1]||"";o.settings[n]=decodeURIComponent(r)})),this.setBookKey(this.settings.bookPath),this.settings.restore&&this.isSaved()&&this.applySavedSettings(),this.settings.styles=this.settings.styles||{fontSize:"100%"},this.book=n=new ePub(this.settings.bookPath,this.settings),this.offline=!1,this.sidebarOpen=!1,this.settings.bookmarks||(this.settings.bookmarks=[]),this.settings.annotations||(this.settings.annotations=[]),this.settings.generatePagination&&n.generatePagination(i.width(),i.height()),this.rendition=n.renderTo("viewer",{ignoreClass:"annotator-hl",width:"100%",height:"100%"}),this.settings.previousLocationCfi?this.displayed=this.rendition.display(this.settings.previousLocationCfi):this.displayed=this.rendition.display(),n.ready.then(function(){o.ReaderController=EPUBJS.reader.ReaderController.call(o,n),o.SettingsController=EPUBJS.reader.SettingsController.call(o,n),o.ControlsController=EPUBJS.reader.ControlsController.call(o,n),o.SidebarController=EPUBJS.reader.SidebarController.call(o,n),o.BookmarksController=EPUBJS.reader.BookmarksController.call(o,n),o.NotesController=EPUBJS.reader.NotesController.call(o,n),window.addEventListener("hashchange",this.hashChanged.bind(this),!1),document.addEventListener("keydown",this.adjustFontSize.bind(this),!1),this.rendition.on("keydown",this.adjustFontSize.bind(this)),this.rendition.on("keydown",o.ReaderController.arrowKeys.bind(this)),this.rendition.on("selected",this.selectedRange.bind(this))}.bind(this)).then(function(){o.ReaderController.hideLoader()}.bind(this)),EPUBJS.reader.plugins)EPUBJS.reader.plugins.hasOwnProperty(r)&&(o[r]=EPUBJS.reader.plugins[r].call(o,n));return n.loaded.metadata.then((function(e){o.MetaController=EPUBJS.reader.MetaController.call(o,e)})),n.loaded.navigation.then((function(e){o.TocController=EPUBJS.reader.TocController.call(o,e)})),window.addEventListener("beforeunload",this.unload.bind(this),!1),this},EPUBJS.Reader.prototype.adjustFontSize=function(e){var t,n=e.ctrlKey||e.metaKey;this.settings.styles&&(this.settings.styles.fontSize||(this.settings.styles.fontSize="100%"),t=parseInt(this.settings.styles.fontSize.slice(0,-1)),n&&187==e.keyCode&&(e.preventDefault(),this.book.setStyle("fontSize",t+2+"%")),n&&189==e.keyCode&&(e.preventDefault(),this.book.setStyle("fontSize",t-2+"%")),n&&48==e.keyCode&&(e.preventDefault(),this.book.setStyle("fontSize","100%")))},EPUBJS.Reader.prototype.addBookmark=function(e){this.isBookmarked(e)>-1||(this.settings.bookmarks.push(e),this.trigger("reader:bookmarked",e))},EPUBJS.Reader.prototype.removeBookmark=function(e){var t=this.isBookmarked(e);-1!==t&&(this.settings.bookmarks.splice(t,1),this.trigger("reader:unbookmarked",t))},EPUBJS.Reader.prototype.isBookmarked=function(e){return this.settings.bookmarks.indexOf(e)},EPUBJS.Reader.prototype.clearBookmarks=function(){this.settings.bookmarks=[]},EPUBJS.Reader.prototype.addNote=function(e){this.settings.annotations.push(e)},EPUBJS.Reader.prototype.removeNote=function(e){var t=this.settings.annotations.indexOf(e);-1!==t&&delete this.settings.annotations[t]},EPUBJS.Reader.prototype.clearNotes=function(){this.settings.annotations=[]},EPUBJS.Reader.prototype.setBookKey=function(e){return this.settings.bookKey||(this.settings.bookKey="epubjsreader:"+EPUBJS.VERSION+":"+window.location.host+":"+e),this.settings.bookKey},EPUBJS.Reader.prototype.isSaved=function(e){return!!localStorage&&null!==localStorage.getItem(this.settings.bookKey)},EPUBJS.Reader.prototype.removeSavedSettings=function(){if(!localStorage)return!1;localStorage.removeItem(this.settings.bookKey)},EPUBJS.Reader.prototype.applySavedSettings=function(){var e;if(!localStorage)return!1;try{e=JSON.parse(localStorage.getItem(this.settings.bookKey))}catch(e){return!1}return!!e&&(e.styles&&(this.settings.styles=EPUBJS.core.defaults(this.settings.styles||{},e.styles)),this.settings=EPUBJS.core.defaults(this.settings,e),!0)},EPUBJS.Reader.prototype.saveSettings=function(){if(this.book&&(this.settings.previousLocationCfi=this.rendition.currentLocation().start.cfi),!localStorage)return!1;localStorage.setItem(this.settings.bookKey,JSON.stringify(this.settings))},EPUBJS.Reader.prototype.unload=function(){this.settings.restore&&localStorage&&this.saveSettings()},EPUBJS.Reader.prototype.hashChanged=function(){var e=window.location.hash.slice(1);this.rendition.display(e)},EPUBJS.Reader.prototype.selectedRange=function(e){var t="#"+e;this.settings.history&&window.location.hash!=t&&(history.pushState({},"",t),this.currentLocationCfi=e)},RSVP.EventTarget.mixin(EPUBJS.Reader.prototype),EPUBJS.reader.BookmarksController=function(){var e=this.book,t=this.rendition,n=$("#bookmarksView"),r=n.find("#bookmarks"),o=document.createDocumentFragment(),i=0,s=function(n){var r=document.createElement("li"),o=document.createElement("a");r.id="bookmark-"+i,r.classList.add("list_item");var s,a=e.spine.get(n);return a.index in e.navigation.toc?(s=e.navigation.toc[a.index],o.textContent=s.label):o.textContent=n,o.href=n,o.classList.add("bookmark_link"),o.addEventListener("click",(function(e){var n=this.getAttribute("href");t.display(n),e.preventDefault()}),!1),r.appendChild(o),i++,r};return this.settings.bookmarks.forEach((function(e){var t=s(e);o.appendChild(t)})),r.append(o),this.on("reader:bookmarked",(function(e){var t=s(e);r.append(t)})),this.on("reader:unbookmarked",(function(e){$("#bookmark-"+e).remove()})),{show:function(){n.show()},hide:function(){n.hide()}}},EPUBJS.reader.ControlsController=function(e){var t=this,n=this.rendition,r=($("#store"),$("#fullscreen")),o=($("#fullscreenicon"),$("#cancelfullscreenicon"),$("#slider")),i=($("#main"),$("#sidebar"),$("#setting")),s=$("#bookmark");return o.on("click",(function(){t.sidebarOpen?(t.SidebarController.hide(),o.addClass("icon-menu"),o.removeClass("icon-right")):(t.SidebarController.show(),o.addClass("icon-right"),o.removeClass("icon-menu"))})),"undefined"!=typeof screenfull&&(r.on("click",(function(){screenfull.toggle($("#container")[0])})),screenfull.raw&&document.addEventListener(screenfull.raw.fullscreenchange,(function(){fullscreen=screenfull.isFullscreen,fullscreen?r.addClass("icon-resize-small").removeClass("icon-resize-full"):r.addClass("icon-resize-full").removeClass("icon-resize-small")}))),i.on("click",(function(){t.SettingsController.show()})),s.on("click",(function(){var e=t.rendition.currentLocation().start.cfi;-1===t.isBookmarked(e)?(t.addBookmark(e),s.addClass("icon-bookmark").removeClass("icon-bookmark-empty")):(t.removeBookmark(e),s.removeClass("icon-bookmark").addClass("icon-bookmark-empty"))})),n.on("relocated",(function(e){var n=e.start.cfi,r="#"+n;-1===t.isBookmarked(n)?s.removeClass("icon-bookmark").addClass("icon-bookmark-empty"):s.addClass("icon-bookmark").removeClass("icon-bookmark-empty"),t.currentLocationCfi=n,t.settings.history&&window.location.hash!=r&&history.pushState({},"",r)})),{}},EPUBJS.reader.MetaController=function(e){var t=e.title,n=e.creator,r=$("#book-title"),o=$("#chapter-title"),i=$("#title-seperator");document.title=t+" – "+n,r.html(t),o.html(n),i.show()},EPUBJS.reader.NotesController=function(){var e=this.book,t=this.rendition,n=this,r=$("#notesView"),o=$("#notes"),i=$("#note-text"),s=$("#note-anchor"),a=n.settings.annotations,c=e.renderer,l=[],u=new ePub.CFI,d=function(){r.show()},f=function(r){var o,a,c,l,d,m=e.renderer.doc;if(m.caretPositionFromPoint?(a=(o=m.caretPositionFromPoint(r.clientX,r.clientY)).offsetNode,c=o.offset):m.caretRangeFromPoint&&(a=(o=m.caretRangeFromPoint(r.clientX,r.clientY)).startContainer,c=o.startOffset),3!==a.nodeType)for(var v=0;v<a.childNodes.length;v++)if(3==a.childNodes[v].nodeType){a=a.childNodes[v];break}-1===(c=a.textContent.indexOf(".",c))?c=a.length:c+=1,l=u.generateCfiFromTextNode(a,c,e.renderer.currentChapter.cfiBase),d={annotatedAt:new Date,anchor:l,body:i.val()},n.addNote(d),h(d),p(d),i.val(""),s.text("Attach"),i.prop("disabled",!1),t.off("click",f)},h=function(e){var n=document.createElement("li"),r=document.createElement("a");n.innerHTML=e.body,r.innerHTML=" context &#187;",r.href="#"+e.anchor,r.onclick=function(){return t.display(e.anchor),!1},n.appendChild(r),o.append(n)},p=function(t){var n=e.renderer.doc,r=document.createElement("span"),o=document.createElement("a");r.classList.add("footnotesuperscript","reader_generated"),r.style.verticalAlign="super",r.style.fontSize=".75em",r.style.lineHeight="1em",o.style.padding="2px",o.style.backgroundColor="#fffa96",o.style.borderRadius="5px",o.style.cursor="pointer",r.id="note-"+EPUBJS.core.uuid(),o.innerHTML=a.indexOf(t)+1+"[Reader]",r.appendChild(o),u.addMarker(t.anchor,n,r),m(r,t.body)},m=function(e,r){var o=e.id,i=function(){l[o].classList.add("on")},s=function(){l[o].classList.remove("on")},a=function(){setTimeout((function(){l[o].classList.remove("show")}),100)};e.addEventListener("mouseover",(function(){var n,u,d,f,h=c.height,p=c.width,m=225;l[o]||(l[o]=document.createElement("div"),l[o].setAttribute("class","popup"),pop_content=document.createElement("div"),l[o].appendChild(pop_content),pop_content.innerHTML=r,pop_content.setAttribute("class","pop_content"),c.render.document.body.appendChild(l[o]),l[o].addEventListener("mouseover",i,!1),l[o].addEventListener("mouseout",s,!1),t.on("locationChanged",a,this),t.on("locationChanged",s,this)),n=l[o],d=(u=e.getBoundingClientRect()).left,f=u.top,n.classList.add("show"),popRect=n.getBoundingClientRect(),n.style.left=d-popRect.width/2+"px",n.style.top=f+"px",m>h/2.5&&(m=h/2.5,pop_content.style.maxHeight=m+"px"),popRect.height+f>=h-25?(n.style.top=f-popRect.height+"px",n.classList.add("above")):n.classList.remove("above"),d-popRect.width<=0?(n.style.left=d+"px",n.classList.add("left")):n.classList.remove("left"),d+popRect.width/2>=p?(n.style.left=d-300+"px",popRect=n.getBoundingClientRect(),n.style.left=d-popRect.width+"px",popRect.height+f>=h-25?(n.style.top=f-popRect.height+"px",n.classList.add("above")):n.classList.remove("above"),n.classList.add("right")):n.classList.remove("right")}),!1),e.addEventListener("mouseout",a,!1),e.addEventListener("click",(function(){n.ReaderController.slideOut(),d()}),!1)};return s.on("click",(function(e){s.text("Cancel"),i.prop("disabled","true"),t.on("click",f)})),a.forEach((function(e){h(e)})),{show:d,hide:function(){r.hide()}}},EPUBJS.reader.ReaderController=function(e){var t=$("#main"),n=$("#divider"),r=$("#loader"),o=$("#next"),i=$("#prev"),s=this,a=(e=this.book,this.rendition),c=function(){n.addClass("show")},l=function(){n.removeClass("show")},u=function(t){37==t.keyCode&&("rtl"===e.package.metadata.direction?a.next():a.prev(),i.addClass("active"),setTimeout((function(){i.removeClass("active")}),100),t.preventDefault()),39==t.keyCode&&("rtl"===e.package.metadata.direction?a.prev():a.next(),o.addClass("active"),setTimeout((function(){o.removeClass("active")}),100),t.preventDefault())};return document.addEventListener("keydown",u,!1),o.on("click",(function(t){"rtl"===e.package.metadata.direction?a.prev():a.next(),t.preventDefault()})),i.on("click",(function(t){"rtl"===e.package.metadata.direction?a.next():a.prev(),t.preventDefault()})),a.on("layout",(function(e){!0===e.spread?c():l()})),a.on("relocated",(function(e){e.atStart&&i.addClass("disabled"),e.atEnd&&o.addClass("disabled")})),{slideOut:function(){var e=a.currentLocation();e&&(e.start.cfi,s.settings.sidebarReflow?(t.addClass("single"),t.one("transitionend",(function(){a.resize()}))):t.addClass("closed"))},slideIn:function(){a.currentLocation().start.cfi,s.settings.sidebarReflow?(t.removeClass("single"),t.one("transitionend",(function(){a.resize()}))):t.removeClass("closed")},showLoader:function(){r.show(),l()},hideLoader:function(){r.hide()},showDivider:c,hideDivider:l,arrowKeys:u}},EPUBJS.reader.SettingsController=function(){var e=(this.book,this),t=$("#settings-modal"),n=$(".overlay"),r=function(){t.removeClass("md-show")};return $("#sidebarReflow").on("click",(function(){e.settings.sidebarReflow=!e.settings.sidebarReflow})),t.find(".closer").on("click",(function(){r()})),n.on("click",(function(){r()})),{show:function(){t.addClass("md-show")},hide:r}},EPUBJS.reader.SidebarController=function(e){var t=this,n=$("#sidebar"),r=$("#panels"),o="Toc",i=function(e){var n=e+"Controller";o!=e&&void 0!==t[n]&&(t[o+"Controller"].hide(),t[n].show(),o=e,r.find(".active").removeClass("active"),r.find("#show-"+e).addClass("active"))};return r.find(".show_view").on("click",(function(e){var t=$(this).data("view");i(t),e.preventDefault()})),{show:function(){t.sidebarOpen=!0,t.ReaderController.slideOut(),n.addClass("open")},hide:function(){t.sidebarOpen=!1,t.ReaderController.slideIn(),n.removeClass("open")},getActivePanel:function(){return o},changePanelTo:i}},EPUBJS.reader.TocController=function(e){var t=(this.book,this.rendition),n=$("#tocView"),r=document.createDocumentFragment(),o=function(e,t){var n=document.createElement("ul");return t||(t=1),e.forEach((function(e){var r,i=document.createElement("li"),s=document.createElement("a");toggle=document.createElement("a"),i.id="toc-"+e.id,i.classList.add("list_item"),s.textContent=e.label,s.href=e.href,s.classList.add("toc_link"),i.appendChild(s),e.subitems&&e.subitems.length>0&&(t++,r=o(e.subitems,t),toggle.classList.add("toc_toggle"),i.insertBefore(toggle,s),i.appendChild(r)),n.appendChild(i)})),n};t.on("renderered",(function(e){var t=e.id,r=n.find("#toc-"+t),o=n.find(".currentChapter");n.find(".openChapter"),r.length&&(r!=o&&r.has(!1).length>0&&o.removeClass("currentChapter"),r.addClass("currentChapter"),r.parents("li").addClass("openChapter"))}));var i=o(e);return r.appendChild(i),n.append(r),n.find(".toc_link").on("click",(function(e){var r=this.getAttribute("href");e.preventDefault(),t.display(r),n.find(".currentChapter").addClass("openChapter").removeClass("currentChapter"),$(this).parent("li").addClass("currentChapter")})),n.find(".toc_toggle").on("click",(function(e){var t=$(this).parent("li"),n=t.hasClass("openChapter");e.preventDefault(),n?t.removeClass("openChapter"):t.addClass("openChapter")})),{show:function(){n.show()},hide:function(){n.hide()}}};